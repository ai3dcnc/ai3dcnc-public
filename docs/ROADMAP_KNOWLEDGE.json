{
  "ts": "2025-08-25T00:00:00Z",
  "version": "1.2",
  "schema_version": "2025-08-25",
  "tcn_grammar_version": "1.0",
  "strict": true,
  "profile": "AI_TOOLS public-lite roadmap knowledge (EN)",
  "doc_ref": "docs/ROADMAP_EXEC.md",

  "legal": {"license": "Apache-2.0", "no_vendor_files": true, "disclaimer": "No vendor files redistributed. Specs and code only."},

  "repo": {
    "slug": "ai3dcnc/ai3dcnc-public",
    "branch": "main",
    "raw_base": "https://raw.githubusercontent.com/ai3dcnc/ai3dcnc-public/main/",
    "raw_manifest_url": "https://raw.githubusercontent.com/ai3dcnc/ai3dcnc-public/main/manifest.json"
  },

  "manifest_hint": {
    "entrypoints": ["parsers_all.py", "builders_all.py", "docs/ROADMAP_KNOWLEDGE.json"],
    "aliases": {
      "parsers_all": "parsers_all.py",
      "builders_all": "builders_all.py",
      "roadmap": "docs/ROADMAP_KNOWLEDGE.json"
    },
    "required_keys": ["raw_base", "entrypoints", "aliases"],
    "note": "Roadmap is sourced from this file via manifest. INTRODUCTION remains the only technical spec."
  },

  "units": {
    "internal": "m",
    "cam": "mm",
    "ui_decimals": 3,
    "conversion": "mm = m * 1000",
    "storage": "optional: store micrometers as integers (um_int) for lossless math; format to 3 decimals only on export",
    "rounding": { "at_export_only": true, "precision_mm_allowed": [1, 0] }
  },

  "coordinates": {
    "axes": { "x": "width", "y": "depth", "z": "thickness" },
    "origin": "Front-Left-Bottom of core",
    "sides": ["F","B","L","R","T","D"],
    "references": { "default": "finished", "switch": "from_finished_edges" }
  },

  "materials_logic": {
    "policy": "semi-strict",
    "rule": "material code -> standard thickness; override allowed and flagged",
    "mapping_examples": [
      {"code": "H1137", "thickness_mm": 18},
      {"code": "U999",  "thickness_mm": 18}
    ],
    "override": {"allowed": true, "flag_attribute": "is_override", "flag_value": 1}
  },

  "gn_pal_board_lite": {
    "group_name": "GN_PAL_Board_Lite",
    "inputs": [
      {"name": "X_m", "type": "float", "min": 0.001},
      {"name": "Y_m", "type": "float", "min": 0.001},
      {"name": "Z_m", "type": "float", "min": 0.001, "note": "thickness; default resolved from MaterialCode"},
      {"name": "MaterialCode", "type": "string"},
      {"name": "ThicknessOverride_mm", "type": "float", "optional": true},
      {"name": "Show_Band", "type": "bool", "default": true}
    ],
    "outputs": [
      {"name": "Board", "type": "mesh"},
      {"name": "EdgeBands", "type": "mesh", "material": "EDGE_BAND"}
    ],
    "edge_bands": {
      "sides": ["F", "B", "L", "R"],
      "width_mm_allowed": [0, 0.8, 1, 2],
      "as_separate_geometry": true,
      "material": "EDGE_BAND",
      "uv": "planar along band length; consistent scale"
    },
    "view_mode": {
      "bevel": {"limit_angle_deg": 30, "width_mm_range": [0.5, 0.8], "segments_range": [1, 2]},
      "normals": ["Harden", "Weighted"],
      "auto_smooth_deg": 30,
      "viewport_hint": "Cavity"
    },
    "acceptance": [
      "Dimensions in meters (3 decimals)",
      "ThicknessOverride_mm != standard -> attribute is_override=1",
      "Show_Band toggles EdgeBands on/off",
      "EDGE_BAND material present on bands"
    ]
  },

  "cnc_markers": {
    "types": ["DRILL", "SLOT", "EDGE_DRILL", "COUNTERSINK"],
    "props_m_required": ["type","side","x_m","y_m","depth_m"],
    "props_m_optional": ["z_m","d_m","w_m","angle_deg","ref"],
    "side_enum": ["F","B","L","R","T","D"],
    "reference": "finished edges by default; switch via from_finished_edges",
    "constraints": [
      "0 <= depth_m <= Z_m",
      "d_m > 0 for DRILL/COUNTERSINK",
      "w_m > 0 for SLOT"
    ],
    "example_pre_cam_m": {
      "ops": [
        {"type":"DRILL","side":"F","x_m":0.120,"y_m":0.250,"z_m":0.000,"d_m":0.005,"depth_m":0.018,"ref":"finished"},
        {"type":"SLOT","side":"B","x_m":0.050,"y_m":0.400,"z_m":0.009,"w_m":0.006,"depth_m":0.010,"angle_deg":0}
      ]
    }
  },

  "schemas": {
    "ops_json_schema_ref": "schemas/ops_json.schema.json",
    "machine_profile_schema_ref": "schemas/machine_profile.schema.json",
    "tpa_example_ref": "samples/tpa_example_v1.json"
  },

  "exporters": {
    "conversion_m_to_mm": "mm = m * 1000",
    "csv": {
      "header": ["job_id","panel_id","type","side","x_mm","y_mm","z_mm","d_mm","w_mm","depth_mm","angle_deg","ref","notes"],
      "csv_example_ref": "samples/ops_example_v1.csv",
      "csv_example_sha1": "TBD"
    },
    "tcn_min_vitap_k2": {
      "format": "ini_like",
      "tcn_min_ref": "samples/tcn_min_v1.tcn",
      "tcn_min_sha1": "TBD",
      "slot_extras": ["W=6.000","ANGLE=0"]
    },
    "dxf_qa": {"units": "m", "layers": ["CUT_OUTER","DRILL","SLOT"]}
  },

  "e2e_demo": {
    "steps": [
      "Run parsers on minimal scene",
      "Generate samples/min_scene_export.json (m)",
      "Export exports/ops.csv and exports/ops.tcn (mm)",
      "Optionally write qa/min_panel.dxf",
      "Document steps and [SUMMARY] lines in docs/TEST_E2E.md"
    ],
    "expected_summary": [
      "[SUMMARY] mesh: meshes=1",
      "[SUMMARY] export_csv: rows=5 file=exports/ops.csv",
      "[SUMMARY] export_tcn: ops=5 file=exports/ops.tcn"
    ]
  },


  "machine_profile": { "default_profile_id": "Vitap_K2", "profile_ref": "profiles/Vitap_K2.profile.json", "profile_sha1": "TBD" },

  "release": {
    "when": "after E2E + machine probes pass",
    "steps": ["tag v0.1-lite", "add CITATION.cff", "Zenodo DOI + README badge"]
  },

  "progress_public_lite": {
    "repo_map_doc": "done",
    "roadmap_knowledge_doc": "done",
    "manifest_entrypoints": "updated",
    "addon_lite": "present",
    "sample_min_scene_export": "present",
    "readme_banner_units": "tbd",
    "defensive_tpa_schema_example": "tbd"
  },

  "gates_flags": { "k2_import_ok": true, "repeatability_hashes": 2, "readme_banner_units": true, "doi_after_e2e": true },

  "qa_checklist": [
    "Design in m, export in mm",
    "Edge bands material = EDGE_BAND",
    "Normals hardened + weighted; AutoSmooth ~ 30 deg",
    "Markers reference from finished edges",
    "CSV header exactly as specified",
    "TCN UNITS=MM present",
    "DXF layers named correctly"
  ],

  "roadmap_e2e_lite": [
    "Freeze spec: lock INTRODUCTION + manifest; units m->mm at export",
    "GN PAL board Lite: X/Y/Z, thickness from material code + override flagged; F/B/L/R edge bands with proper UV",
    "Markers + schema: DRILL/SLOT/EDGE_DRILL/COUNTERSINK; schemas/ops_json.schema.json (mm) + example",
    "CNC exporters Lite: CSV/TXT canonical; DXF optional; minimal .tcn for Vitap K2",
    "E2E demo public: run parsers on min scene; capture [SUMMARY] -> docs/TEST_E2E.md",
    "Machine probes: Vitap K2 import .tcn; Homag circular cutter sample",
    "Tag pre-release v0.1-lite + CITATION.cff",
    "Zenodo DOI + README badge (after steps 5â€“6 pass)"
  ],

  "tooling_cli": [
    "ai3dcnc tcn validate   --in ops.tcn --machine Vitap_K2",
    "ai3dcnc tcn to-json    --in ops.tcn --out ops.json --machine Vitap_K2",
    "ai3dcnc tcn from-json  --in ops.json --out ops.tcn --machine Vitap_K2",
    "ai3dcnc dxf to-tcn     --in drawing.dxf --out ops.tcn --machine Vitap_K2",
    "ai3dcnc report html    --run last --out reports/run_001.html"
  ],

  "examples": {
    "scene_m_inline_min": {
      "version": "1.0",
      "units": "m",
      "ref": "finished",
      "ops_m": [
        {"type": "DRILL", "side": "F", "x_m": 0.120, "y_m": 0.250, "d_m": 0.005, "depth_m": 0.018},
        {"type": "SLOT", "side": "B", "x_m": 0.050, "y_m": 0.400, "w_m": 0.006, "depth_m": 0.010, "angle_deg": 0}
      ]
    },
    "json_tpa_mm_inline_min": {
      "version": "1.0",
      "units": "mm",
      "ref": "finished",
      "ops_mm": [
        {"type": "DRILL", "side": "F", "x_mm": 120.0, "y_mm": 250.0, "d_mm": 5.0, "depth_mm": 18.0},
        {"type": "SLOT", "side": "B", "x_mm": 50.0, "y_mm": 400.0, "w_mm": 6.0, "depth_mm": 10.0, "angle_deg": 0}
      ]
    }
  },

  "mappings": {
    "ref": { "json": ["finished", "core"], "tcn": ["FINISHED", "CORE"] }
  },

  "test_corpus": {
    "tcn": [
      {"name": "drill_grid_3x3", "tags": ["DRILL","F"]},
      {"name": "slot_longitudinal_angle0", "tags": ["SLOT","B"]},
      {"name": "edge_drill_line_L", "tags": ["EDGE_DRILL","L"]},
      {"name": "countersink_pair", "tags": ["COUNTERSINK","T"]},
      {"name": "profile_rectangle_outer", "tags": ["PROFILE"]},
      {"name": "saw_cut_90", "tags": ["SAW"]},
      {"name": "saw_cut_45", "tags": ["SAW"]},
      {"name": "mix_core_ref", "tags": ["MIXED","core"]},
      {"name": "thickness_override_16_18_19", "tags": ["THICKNESS"]},
      {"name": "edge_limits", "tags": ["LIMITS"]}
    ],
    "dxf": [
      {"name": "cut_outer_simple", "layers": ["CUT_OUTER"]},
      {"name": "cut_with_holes", "layers": ["CUT_OUTER","DRILL"]},
      {"name": "slots_layered", "layers": ["SLOT"]},
      {"name": "drill_prefix_text", "prefix": ["DL 5.0","DL 8.0"]},
      {"name": "mixed_all", "layers": ["CUT_OUTER","DRILL","SLOT"]}
    ]
  },

  "ci": {
    "workflow_ref": ".github/workflows/ai3dcnc.yml",
    "python": "3.11",
    "jobs": ["schema-check","lint","unit-tests","corpus-tests","round-trip","report-html"],
    "commands": [
      "ai3dcnc schemas validate",
      "ai3dcnc corpus run --roundtrip",
      "ai3dcnc report html --run last"
    ],
    "artifacts": ["exports/*.tcn","exports/*.json","reports/*.html","hashes.txt"]
  },

  "risks": [
    {"id": "Z-sign", "mitigation": "machine_profile + field tests"},
    {"id": "W-id-divergences", "mitigation": "per-machine mappings"},
    {"id": "rounding", "mitigation": "fixed 3 decimals + idempotence test"}
  ],

  "milestones": [
    {"id": "M1", "name": "Schema + parser", "done": false},
    {"id": "M2", "name": "Generator + determinism", "done": false},
    {"id": "M3", "name": "DXF mapper", "done": false},
    {"id": "M4", "name": "CI + reports", "done": false},
    {"id": "M5", "name": "Vitap K2 tests + v0.1-lite + DOI", "done": false}
  ],

  "next_steps": [
    "Write schemas/ops_json.schema.json and schemas/machine_profile.schema.json",
    "Implement TCN parser + rule validators",
    "Generate TCN from JSON (DRILL, SLOT, PROFILE, SAW)",
    "Seed corpus: 30 TCN + 10 DXF",
    "Round-trip: TCN->JSON->TCN, KPI >= 95%",
    "CI: HTML reports + artifacts",
    "Vitap K2 tests + tag v0.1-lite + DOI"
  ]
}
